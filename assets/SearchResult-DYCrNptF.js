import{u as z,h as se,i as te,j as O,k as le,l as oe,t as ae,m as ne,n as D,p as H,q as ie,w as P,v as t,x as re,R as T,y as ue,z as ce,A as me,B as de,C as he,D as ve,E as _e,F as pe,G as ye,H as ge,I as we,J as I,K as M,L as ke,M as x,N as be}from"./app-Bq8cTqK8.js";const fe=["/","/en/","/notes/3d-objects.html","/notes/3d-scene.html","/notes/","/notes/cy-simulation.html","/notes/debug.html","/notes/event-scheduling.html","/notes/lp.html","/notes/lua.html","/notes/mip.html","/notes/network.html","/notes/oop.html","/notes/plots.html","/notes/timelapse.html","/notes/tools.html","/notes/versions.html","/notes/visualization.html","/notes/warehouse-simulation.html","/notes/web-ui.html","/docs/desktop/1.1_what_microcity_can_do.html","/docs/desktop/2.1_showing_a_world_map.html","/docs/desktop/2.2_searching_for_countries.html","/docs/desktop/3.1_ui_overview.html","/docs/desktop/3.2_vector_shapes.html","/docs/desktop/3.3_raster_grids.html","/docs/desktop/3.4_3d_scenes.html","/docs/desktop/3.5_tables.html","/docs/desktop/3.6_maps_and_layers.html","/docs/desktop/3.7_modules.html","/docs/desktop/4.1_si_overview.html","/docs/desktop/4.2_ui_control.html","/docs/desktop/4.3_shapes_and_tables.html","/docs/desktop/4.4_grids.html","/docs/desktop/4.5_3d_scenes.html","/docs/desktop/4.6_networks.html","/docs/desktop/4.7_des_simulations.html","/docs/desktop/4.8_mixed_integer_programming.html","/docs/desktop/","/docs/web/1.1_what_microcity_web_can_do.html","/docs/web/2.1_rolling_a_cube.html","/docs/web/2.2_searching_for_countries.html","/docs/web/3.1_ui_overview.html","/docs/web/3.2_editing_scripts.html","/docs/web/3.3_running_scripts.html","/docs/web/3.4_navigating_scenes.html","/docs/web/4.1_si_overview.html","/docs/web/4.2_operation_system.html","/docs/web/4.3_scene_and_object.html","/docs/web/4.4_discrete_event_simulation.html","/docs/web/4.5_mixed_integer_programming.html","/docs/web/","/en/docs/1.1_what_microcity_can_do.html","/en/docs/2.1_showing_a_world_map.html","/en/docs/2.2_searching_for_countries.html","/en/docs/3.1_ui_overview.html","/en/docs/3.2_vector_shapes.html","/en/docs/3.3_raster_grids.html","/en/docs/3.4_3d_scenes.html","/en/docs/3.5_tables.html","/en/docs/3.6_maps_and_layers.html","/en/docs/3.7_modules.html","/en/docs/4.1_si_overview.html","/en/docs/4.2_ui_control.html","/en/docs/4.3_shapes_and_tables.html","/en/docs/4.4_grids.html","/en/docs/4.5_3d_scenes.html","/en/docs/4.6_networks.html","/en/docs/4.7_des_simulations.html","/en/docs/4.8_mixed_integer_programming.html","/en/docs/","/en/notes/3d-objects.html","/en/notes/3d-scene.html","/en/notes/","/en/notes/cy-simulation.html","/en/notes/debug.html","/en/notes/event-scheduling.html","/en/notes/lp.html","/en/notes/lua.html","/en/notes/mip.html","/en/notes/network.html","/en/notes/oop.html","/en/notes/plots.html","/en/notes/timelapse.html","/en/notes/tools.html","/en/notes/versions.html","/en/notes/visualization.html","/en/notes/warehouse-simulation.html","/en/notes/web-ui.html","/images/doc/","/notes/gallery/build-a-clock.html","/notes/gallery/build-an-elevator.html","/notes/gallery/exp-extended-bisect-search.html","/404.html"],He="SLIMSEARCH_QUERY_HISTORY",p=z(He,[]),xe=()=>{const{queryHistoryCount:l}=x,o=l>0;return{enabled:o,queryHistories:p,addQueryHistory:a=>{o&&(p.value=Array.from(new Set([a,...p.value.slice(0,l-1)])))},removeQueryHistory:a=>{p.value=[...p.value.slice(0,a),...p.value.slice(a+1)]}}},A=l=>fe[l.id]+("anchor"in l?`#${l.anchor}`:""),Re="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:U}=x,y=z(Re,[]),Qe=()=>{const l=U>0;return{enabled:l,resultHistories:y,addResultHistory:o=>{if(l){const a={link:A(o),display:o.display};"header"in o&&(a.header=o.header),y.value=[a,...y.value.slice(0,U-1)]}},removeResultHistory:o=>{y.value=[...y.value.slice(0,o),...y.value.slice(o+1)]}}},qe=l=>{const o=de(),a=O(),R=he(),i=D(0),w=H(()=>i.value>0),v=ve([]);return _e(()=>{const{search:_,terminate:Q}=pe(),g=ke(u=>{const{resultsFilter:k=r=>r,querySplitter:E,suggestionsFilter:q,...C}=o.value;u?(i.value+=1,_(u,a.value,C).then(r=>k(r,u,a.value,R.value)).then(r=>{i.value-=1,v.value=r}).catch(r=>{console.warn(r),i.value-=1,i.value||(v.value=[])})):v.value=[]},x.searchDelay-x.suggestDelay,{maxWait:5e3});P([l,a],([u])=>{g(u.join(" "))},{immediate:!0}),ye(()=>{Q()})}),{isSearching:w,results:v}};var Se=se({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:o}){const a=te(),R=O(),i=le(oe),{enabled:w,addQueryHistory:v,queryHistories:_,removeQueryHistory:Q}=xe(),{enabled:g,resultHistories:u,addResultHistory:k,removeResultHistory:E}=Qe(),q=w||g,C=ae(l,"queries"),{results:r,isSearching:Y}=qe(C),n=ne({isQuery:!0,index:0}),d=D(0),h=D(0),j=H(()=>q&&(_.value.length>0||u.value.length>0)),S=H(()=>r.value.length>0),L=H(()=>r.value[d.value]||null),B=()=>{const{isQuery:e,index:s}=n;s===0?(n.isQuery=!e,n.index=e?u.value.length-1:_.value.length-1):n.index=s-1},G=()=>{const{isQuery:e,index:s}=n;s===(e?_.value.length-1:u.value.length-1)?(n.isQuery=!e,n.index=0):n.index=s+1},J=()=>{d.value=d.value>0?d.value-1:r.value.length-1,h.value=L.value.contents.length-1},K=()=>{d.value=d.value<r.value.length-1?d.value+1:0,h.value=0},N=()=>{h.value<L.value.contents.length-1?h.value+=1:K()},V=()=>{h.value>0?h.value-=1:J()},$=e=>e.map(s=>be(s)?s:t(s[0],s[1])),W=e=>{if(e.type==="customField"){const s=ge[e.index]||"$content",[c,f=""]=we(s)?s[R.value].split("$content"):s.split("$content");return e.display.map(m=>t("div",$([c,...m,f])))}return e.display.map(s=>t("div",$(s)))},b=()=>{d.value=0,h.value=0,o("updateQuery",""),o("close")},X=()=>w?t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},i.value.queryHistory),_.value.map((e,s)=>t("div",{class:["slimsearch-result-item",{active:n.isQuery&&n.index===s}],onClick:()=>{o("updateQuery",e)}},[t(I,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},e),t("button",{class:"slimsearch-remove-icon",innerHTML:M,onClick:c=>{c.preventDefault(),c.stopPropagation(),Q(s)}})]))])):null,Z=()=>g?t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},i.value.resultHistory),u.value.map((e,s)=>t(T,{to:e.link,class:["slimsearch-result-item",{active:!n.isQuery&&n.index===s}],onClick:()=>{b()}},()=>[t(I,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(c=>$(c)).flat())]),t("button",{class:"slimsearch-remove-icon",innerHTML:M,onClick:c=>{c.preventDefault(),c.stopPropagation(),E(s)}})]))])):null;return ie("keydown",e=>{if(l.isFocusing){if(S.value){if(e.key==="ArrowUp")V();else if(e.key==="ArrowDown")N();else if(e.key==="Enter"){const s=L.value.contents[h.value];v(l.queries.join(" ")),k(s),a.push(A(s)),b()}}else if(g){if(e.key==="ArrowUp")B();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const{index:s}=n;n.isQuery?(o("updateQuery",_.value[s]),e.preventDefault()):(a.push(u.value[s].link),b())}}}}),P([d,h],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["slimsearch-result-wrapper",{empty:l.queries.length?!S.value:!j.value}],id:"slimsearch-results"},l.queries.length?Y.value?t(re,{hint:i.value.searching}):S.value?t("ul",{class:"slimsearch-result-list"},r.value.map(({title:e,contents:s},c)=>{const f=d.value===c;return t("li",{class:["slimsearch-result-list-item",{active:f}]},[t("div",{class:"slimsearch-result-title"},e||i.value.defaultTitle),s.map((m,ee)=>{const F=f&&h.value===ee;return t(T,{to:A(m),class:["slimsearch-result-item",{active:F,"aria-selected":F}],onClick:()=>{v(l.queries.join(" ")),k(m),b()}},()=>[m.type==="text"?null:t(m.type==="title"?ue:m.type==="heading"?ce:me,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[m.type==="text"&&m.header?t("div",{class:"content-header"},m.header):null,t("div",W(m))])])})])})):i.value.emptyResult:q?j.value?[X(),Z()]:i.value.emptyHistory:i.value.emptyResult)}});export{Se as default};

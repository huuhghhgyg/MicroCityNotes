import{_ as i,r as s,o as c,c as l,a as e,b as a,d as n,w as d,e as t}from"./app-74QKXaVC.js";const u={},r=t(`<h1 id="_4-2-操作系统" tabindex="-1"><a class="header-anchor" href="#_4-2-操作系统"><span>4.2 操作系统</span></a></h1><p>这部分功能涉及控制一些基本特性，有些由浏览器提供，其他则源自Lua调试。</p><h2 id="浏览器" tabindex="-1"><a class="header-anchor" href="#浏览器"><span>浏览器</span></a></h2><p>浏览器提供JavaScript运行环境、存储和网络通信功能。</p><p><a id="os.execute"> os.execute (javascript) </a></p><p>访问底层JavaScript引擎的接口。此函数将<strong>等待 eval()</strong> 给定的JavaScript，并将结果作为字符串返回。</p><p>动态执行JavaScript可以极大地扩展MicroCity Web的功能。请注意，Lua引擎在web worker中运行，因此访问DOM需要执行辅助函数<strong>RemoteCall</strong>。以下是一个简单的示例：</p><div class="language-lua" data-ext="lua" data-title="lua"><pre class="language-lua"><code>os<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">&quot;RemoteCall(&#39;alert&#39;, &#39;hello!&#39;)&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>一个更复杂的示例是使用Python的fastapi创建应用程序，并在MicroCity Web中调用： <br>1. 首先安装fastapi：<code>pip install fastapi uvicorn</code><br>2. 然后创建 main.py：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
app = FastAPI()
app.add_middleware(
  CORSMiddleware,
  allow_origins=[&#39;\\*&#39;],
  allow_credentials=True,
  allow_methods=[&#39;\\*&#39;],
  allow_headers=[&#39;\\*&#39;],
)
@app.get(&quot;/msg&quot;)
async def read_msg():
  return {&quot;msg&quot;: &quot;Hello from FastAPI&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3. 执行 main.py：<code>uvicorn main:app --reload</code><br>4. 最后在MicroCity Web中运行以下脚本：</p><div class="language-lua" data-ext="lua" data-title="lua"><pre class="language-lua"><code><span class="token function">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">&quot;(async () =&gt; (await (await fetch(&#39;http://127.0.0.1:8000/msg&#39;)).json()).msg)()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>或</p><div class="language-lua" data-ext="lua" data-title="lua"><pre class="language-lua"><code><span class="token function">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">&quot;fetch(&#39;http://127.0.0.1:8000/msg&#39;).then(res =&gt; res.json()).then(data =&gt; data.msg)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><a id="os.sleep"> os.sleep (ms) </a></p><p>将睡眠<code>ms</code>毫秒。</p><p><a id="os.getready"> os.getready () </a></p><p>如果单击<strong>暂停</strong><img src="https://microcity.github.io/img/pause.svg" alt="">将暂停执行，如果单击<strong>停止</strong><img src="https://microcity.github.io/img/stop.svg" alt="">将返回false。</p><p>这对控制长时间运行脚本很有用。用户可以暂停它，然后在控制台运行一些命令或停止它。</p><p><a id="os.upload"> os.upload ([url]) </a></p><p>访问url链接中的文件或提示用户选择要上传到虚拟磁盘的本地文件。</p><p>此功能用于使脚本访问外部文件变得更便捷。用户可以先上传文件，然后启动程序。</p><p><a id="os.download"> os.download ([fpath]) </a></p><p>从fpath路径或提示用户选择要从虚拟磁盘下载的文件。</p><h2 id="大型语言模型" tabindex="-1"><a class="header-anchor" href="#大型语言模型"><span>大型语言模型</span></a></h2>`,25),g=t('<p><a id="os.chatcmpl"> os.chatcmpl (user [, system])</a></p><p>给定一个系统消息（提示）和由对话组成的用户消息，模型将返回一个响应。</p><p><a id="os.embedding"> os.embedding (input)</a></p><p>创建代表输入文本的嵌入向量（具有1024个浮点数的数组）。</p><h2 id="调试" tabindex="-1"><a class="header-anchor" href="#调试"><span>调试</span></a></h2><p>调试库保留了 Lua 的原始功能并进行了修改。用户可以在脚本中或控制台上执行它们。</p><p><a id="debug.debug"> debug.debug ([b]) </a></p><p>进入调试模式（无参数或 b 为 true）或退出调试模式（b 为 false）。</p><p><a id="debug.pause"> debug.pause () </a></p><p>在调试模式下暂停执行。</p><p><a id="debug.cont"> debug.cont () </a></p><p>在调试模式下继续执行。</p><p><a id="debug.step"> debug.step () </a></p><p>在调试模式下逐步执行。</p><p><a id="debug.stepi"> debug.stepi () </a></p><p>在调试模式下逐步执行进入。</p><p><a id="debug.stepo"> debug.stepo () </a></p><p>在调试模式下逐步执行退出。</p><p><a id="debug.watch"> debug.watch ([name])</a></p><p>将具有名称（字符串）的变量添加到监视列表，或清除监视列表（没有名称）。</p>',20),m={href:"https://github.com/huuhghhgyg/MicroCityNotes/issues/new",target:"_blank",rel:"noopener noreferrer"},h=e("strong",null,"反馈",-1);function b(v,_){const p=s("RouterLink"),o=s("ExternalLinkIcon");return c(),l("div",null,[r,e("p",null,[a("这些函数可以触发远程REST API进行对话完成和嵌入。API可以进行"),n(p,{to:"/docs/web/3.2_editing_scripts.html#codegen"},{default:d(()=>[a("自定义")]),_:1}),a("。")]),g,e("blockquote",null,[e("p",null,[a("本文使用ChatGPT翻译，如有遗漏请"),e("a",m,[h,n(o)]),a("。")])])])}const k=i(u,[["render",b],["__file","4.2_operation_system.html.vue"]]);export{k as default};

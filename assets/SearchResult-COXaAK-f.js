import{l as N,u as X,m as M,n as Z,y as ee,t as se,p as te,q as L,v as f,x as t,z as le,w as oe,A as ae,R as T,B as ne,D as ie,E as re,F as ue,G as ce,H as $,J as j,K as me,L as de,M as he,N as ve,O as _e,Q as pe,S as ye,T as ge,U,V as we,W as H}from"./app-CGYoAsnN.js";const ke=["/","/en/","/notes/3d-objects.html","/notes/3d-scene.html","/notes/","/notes/cy-simulation.html","/notes/debug.html","/notes/event-scheduling.html","/notes/lp.html","/notes/lua.html","/notes/mip.html","/notes/network.html","/notes/oop.html","/notes/plots.html","/notes/timelapse.html","/notes/tools.html","/notes/versions.html","/notes/visualization.html","/notes/warehouse-simulation.html","/notes/web-ui.html","/docs/desktop/1.1_what_microcity_can_do.html","/docs/desktop/2.1_showing_a_world_map.html","/docs/desktop/2.2_searching_for_countries.html","/docs/desktop/3.1_ui_overview.html","/docs/desktop/3.2_vector_shapes.html","/docs/desktop/3.3_raster_grids.html","/docs/desktop/3.4_3d_scenes.html","/docs/desktop/3.5_tables.html","/docs/desktop/3.6_maps_and_layers.html","/docs/desktop/3.7_modules.html","/docs/desktop/4.1_si_overview.html","/docs/desktop/4.2_ui_control.html","/docs/desktop/4.3_shapes_and_tables.html","/docs/desktop/4.4_grids.html","/docs/desktop/4.5_3d_scenes.html","/docs/desktop/4.6_networks.html","/docs/desktop/4.7_des_simulations.html","/docs/desktop/4.8_mixed_integer_programming.html","/docs/desktop/","/docs/web/1.1_what_microcity_web_can_do.html","/docs/web/2.1_rolling_a_cube.html","/docs/web/2.2_searching_for_countries.html","/docs/web/3.1_ui_overview.html","/docs/web/3.2_editing_scripts.html","/docs/web/3.3_running_scripts.html","/docs/web/3.4_navigating_scenes.html","/docs/web/4.1_si_overview.html","/docs/web/4.2_operation_system.html","/docs/web/4.3_scene_and_object.html","/docs/web/4.4_discrete_event_simulation.html","/docs/web/4.5_mixed_integer_programming.html","/docs/web/","/en/docs/1.1_what_microcity_can_do.html","/en/docs/2.1_showing_a_world_map.html","/en/docs/2.2_searching_for_countries.html","/en/docs/3.1_ui_overview.html","/en/docs/3.2_vector_shapes.html","/en/docs/3.3_raster_grids.html","/en/docs/3.4_3d_scenes.html","/en/docs/3.5_tables.html","/en/docs/3.6_maps_and_layers.html","/en/docs/3.7_modules.html","/en/docs/4.1_si_overview.html","/en/docs/4.2_ui_control.html","/en/docs/4.3_shapes_and_tables.html","/en/docs/4.4_grids.html","/en/docs/4.5_3d_scenes.html","/en/docs/4.6_networks.html","/en/docs/4.7_des_simulations.html","/en/docs/4.8_mixed_integer_programming.html","/en/docs/","/en/notes/3d-objects.html","/en/notes/3d-scene.html","/en/notes/","/en/notes/cy-simulation.html","/en/notes/debug.html","/en/notes/event-scheduling.html","/en/notes/lp.html","/en/notes/lua.html","/en/notes/mip.html","/en/notes/network.html","/en/notes/oop.html","/en/notes/plots.html","/en/notes/timelapse.html","/en/notes/tools.html","/en/notes/versions.html","/en/notes/visualization.html","/en/notes/warehouse-simulation.html","/en/notes/web-ui.html","/images/doc/","/notes/gallery/build-a-clock.html","/notes/gallery/build-an-elevator.html","/notes/gallery/computational-complexity.html","/notes/gallery/exp-extended-bisect-search.html","/404.html"],be="SLIMSEARCH_QUERY_HISTORY",p=U(be,[]),fe=()=>{const{queryHistoryCount:o}=H;return{enabled:o>0,queryHistories:p,addQueryHistory:i=>{p.value=Array.from(new Set([i,...p.value.slice(0,o-1)]))},removeQueryHistory:i=>{p.value=[...p.value.slice(0,i),...p.value.slice(i+1)]}}},D=o=>ke[o.id]+("anchor"in o?`#${o.anchor}`:""),He="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:F}=H,y=U(He,[]),xe=()=>({enabled:F>0,resultHistories:y,addResultHistory:n=>{{const i={link:D(n),display:n.display};"header"in n&&(i.header=n.header),y.value=[i,...y.value.slice(0,F-1)]}},removeResultHistory:n=>{y.value=[...y.value.slice(0,n),...y.value.slice(n+1)]}}),Re=o=>{const n=me(),i=M(),x=de(),r=L(0),g=f(()=>r.value>0),m=he([]);return ve(()=>{const{search:R,terminate:h}=_e(),w=ye(v=>{const{resultsFilter:Q=l=>l,querySplitter:_,suggestionsFilter:A,...a}=n.value;v?(r.value+=1,R(v,i.value,a).then(l=>Q(l,v,i.value,x.value)).then(l=>{r.value-=1,m.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(m.value=[])})):m.value=[]},H.searchDelay-H.suggestDelay,{maxWait:5e3});pe([o,i],([v])=>w(v.join(" "))),ge(()=>{h()})}),{isSearching:g,results:m}};var qe=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(o,{emit:n}){const i=X(),x=M(),r=Z(ee),{addQueryHistory:g,queryHistories:m,removeQueryHistory:R}=fe(),{resultHistories:h,addResultHistory:w,removeResultHistory:v}=xe(),Q=se(o,"queries"),{results:_,isSearching:A}=Re(Q),a=te({isQuery:!0,index:0}),l=L(0),d=L(0),E=f(()=>m.value.length>0||h.value.length>0),q=f(()=>_.value.length>0),S=f(()=>_.value[l.value]||null),O=()=>{const{isQuery:e,index:s}=a;s===0?(a.isQuery=!e,a.index=e?h.value.length-1:m.value.length-1):a.index=s-1},P=()=>{const{isQuery:e,index:s}=a;s===(e?m.value.length-1:h.value.length-1)?(a.isQuery=!e,a.index=0):a.index=s+1},z=()=>{l.value=l.value>0?l.value-1:_.value.length-1,d.value=S.value.contents.length-1},Y=()=>{l.value=l.value<_.value.length-1?l.value+1:0,d.value=0},B=()=>{d.value<S.value.contents.length-1?d.value+=1:Y()},V=()=>{d.value>0?d.value-=1:z()},C=e=>e.map(s=>we(s)?s:t(s[0],s[1])),W=e=>{if(e.type==="customField"){const s=ue[e.index]||"$content",[u,b=""]=ce(s)?s[x.value].split("$content"):s.split("$content");return e.display.map(c=>t("div",C([u,...c,b])))}return e.display.map(s=>t("div",C(s)))},k=()=>{l.value=0,d.value=0,n("updateQuery",""),n("close")},G=()=>t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},r.value.queryHistory),m.value.map((e,s)=>t("div",{class:["slimsearch-result-item",{active:a.isQuery&&a.index===s}],onClick:()=>{n("updateQuery",e)}},[t($,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},e),t("button",{class:"slimsearch-remove-icon",innerHTML:j,onClick:u=>{u.preventDefault(),u.stopPropagation(),R(s)}})]))])),J=()=>t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},r.value.resultHistory),h.value.map((e,s)=>t(T,{to:e.link,class:["slimsearch-result-item",{active:!a.isQuery&&a.index===s}],onClick:()=>{k()}},()=>[t($,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(u=>C(u)).flat())]),t("button",{class:"slimsearch-remove-icon",innerHTML:j,onClick:u=>{u.preventDefault(),u.stopPropagation(),v(s)}})]))]));return le("keydown",e=>{if(o.isFocusing){if(q.value){if(e.key==="ArrowUp")V();else if(e.key==="ArrowDown")B();else if(e.key==="Enter"){const s=S.value.contents[d.value];g(o.queries.join(" ")),w(s),i.push(D(s)),k()}}else if(e.key==="ArrowUp")O();else if(e.key==="ArrowDown")P();else if(e.key==="Enter"){const{index:s}=a;a.isQuery?(n("updateQuery",m.value[s]),e.preventDefault()):(i.push(h.value[s].link),k())}}}),oe([l,d],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["slimsearch-result-wrapper",{empty:o.queries.length?!q.value:!E.value}],id:"slimsearch-results"},o.queries.length?A.value?t(ae,{hint:r.value.searching}):q.value?t("ul",{class:"slimsearch-result-list"},_.value.map(({title:e,contents:s},u)=>{const b=l.value===u;return t("li",{class:["slimsearch-result-list-item",{active:b}]},[t("div",{class:"slimsearch-result-title"},e||r.value.defaultTitle),s.map((c,K)=>{const I=b&&d.value===K;return t(T,{to:D(c),class:["slimsearch-result-item",{active:I,"aria-selected":I}],onClick:()=>{g(o.queries.join(" ")),w(c),k()}},()=>[c.type==="text"?null:t(c.type==="title"?ne:c.type==="heading"?ie:re,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[c.type==="text"&&c.header?t("div",{class:"content-header"},c.header):null,t("div",W(c))])])})])})):r.value.emptyResult:E.value?[G(),J()]:r.value.emptyHistory)}});export{qe as default};

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="alternate" hreflang="zh-cn" href="https://huuhghhgyg.github.io/MicroCityNotes/notes/event-scheduling.html"><meta property="og:url" content="https://huuhghhgyg.github.io/MicroCityNotes/en/notes/event-scheduling.html"><meta property="og:site_name" content="MicroCity Notes"><meta property="og:title" content="Discrete Event Simulation and Program Control"><meta property="og:description" content="Discrete Event Simulation and Program Control This article mainly introduces how to implement discrete event simulation and program control in MicroCity Web. Coroutine MicroCity..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:locale:alternate" content="zh-CN"><meta property="og:updated_time" content="2024-06-09T09:39:41.000Z"><meta property="article:modified_time" content="2024-06-09T09:39:41.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Discrete Event Simulation and Program Control","image":[""],"dateModified":"2024-06-09T09:39:41.000Z","author":[]}</script><meta name="keywords" content="MicroCity,Notes,Docs"><link rel="manifest" href="/MicroCityNotes/manifest.webmanifest"><link rel="manifest" href="/MicroCityNotes/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><title>Discrete Event Simulation and Program Control | MicroCity Notes</title><meta name="description" content="Discrete Event Simulation and Program Control This article mainly introduces how to implement discrete event simulation and program control in MicroCity Web. Coroutine MicroCity...">
    <link rel="preload" href="/MicroCityNotes/assets/style-CAoSAIai.css" as="style"><link rel="stylesheet" href="/MicroCityNotes/assets/style-CAoSAIai.css">
    <link rel="modulepreload" href="/MicroCityNotes/assets/app-DBXIMjCi.js"><link rel="modulepreload" href="/MicroCityNotes/assets/event-scheduling.html-CfWcwhRP.js"><link rel="modulepreload" href="/MicroCityNotes/assets/CommandBar-d5KLbhs-.js">
    
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/MicroCityNotes/en/"><img class="vp-site-logo" src="/MicroCityNotes/images/icon_microcitynotes.png" alt="MicroCity Notes"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">MicroCity Notes</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/MicroCityNotes/en/notes/" aria-label="Notes"><!---->Notes<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Documentation"><span class="title">Documentation</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Documentation"><span class="title">Documentation</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/microcity/microcity.github.io/tree/master/doc" aria-label="MicroCity Web" rel="noopener noreferrer" target="_blank"><!---->MicroCity Web<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/" aria-label="MicroCity Desktop"><!---->MicroCity Desktop<!----></a></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/1.1_what_microcity_can_do.html" aria-label="1. MicroCity Introduction"><!---->1. MicroCity Introduction<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/2.1_showing_a_world_map.html" aria-label="2. Getting Started with MicroCity"><!---->2. Getting Started with MicroCity<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/3.1_ui_overview.html" aria-label="3. User Interface"><!---->3. User Interface<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/4.1_si_overview.html" aria-label="4. Script Writing"><!---->4. Script Writing<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="MicroCity Links"><span class="title">MicroCity Links</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="MicroCity Links"><span class="title">MicroCity Links</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>GitHub</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/microcity/Desktop" aria-label="MicroCity Desktop Repository" rel="noopener noreferrer" target="_blank"><!---->MicroCity Desktop Repository<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/microcity/microcity.github.io" aria-label="MicroCity Web Repository" rel="noopener noreferrer" target="_blank"><!---->MicroCity Web Repository<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="auto-link external-link" href="https://microcity.github.io/" aria-label="MicroCity Web Online Environment" rel="noopener noreferrer" target="_blank"><!---->MicroCity Web Online Environment<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/MicroCityNotes/notes/event-scheduling.html" aria-label="简体中文"><!---->简体中文<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/MicroCityNotes/en/notes/event-scheduling.html" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/MicroCityNotes/en/notes/" aria-label="Notes"><!---->Notes<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Documentation"><span class="title">Documentation</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Documentation"><span class="title">Documentation</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/microcity/microcity.github.io/tree/master/doc" aria-label="MicroCity Web" rel="noopener noreferrer" target="_blank"><!---->MicroCity Web<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/" aria-label="MicroCity Desktop"><!---->MicroCity Desktop<!----></a></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/1.1_what_microcity_can_do.html" aria-label="1. MicroCity Introduction"><!---->1. MicroCity Introduction<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/2.1_showing_a_world_map.html" aria-label="2. Getting Started with MicroCity"><!---->2. Getting Started with MicroCity<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/3.1_ui_overview.html" aria-label="3. User Interface"><!---->3. User Interface<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/MicroCityNotes/en/docs/4.1_si_overview.html" aria-label="4. Script Writing"><!---->4. Script Writing<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="MicroCity Links"><span class="title">MicroCity Links</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="MicroCity Links"><span class="title">MicroCity Links</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>GitHub</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/microcity/Desktop" aria-label="MicroCity Desktop Repository" rel="noopener noreferrer" target="_blank"><!---->MicroCity Desktop Repository<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/microcity/microcity.github.io" aria-label="MicroCity Web Repository" rel="noopener noreferrer" target="_blank"><!---->MicroCity Web Repository<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="auto-link external-link" href="https://microcity.github.io/" aria-label="MicroCity Web Online Environment" rel="noopener noreferrer" target="_blank"><!---->MicroCity Web Online Environment<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/MicroCityNotes/notes/event-scheduling.html" aria-label="简体中文"><!---->简体中文<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/MicroCityNotes/en/notes/event-scheduling.html" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading" href="/MicroCityNotes/en/notes/" aria-label="Table of Contents"><!---->Table of Contents<!----></a><!----></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">General Knowledge <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/lua.html" aria-label="Quick Start with Lua Language"><!---->Quick Start with Lua Language<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/versions.html" aria-label="Version Information of MicroCity"><!---->Version Information of MicroCity<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/timelapse.html" aria-label="Advancement of Simulation Time"><!---->Advancement of Simulation Time<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/oop.html" aria-label="Object-Oriented Programming"><!---->Object-Oriented Programming<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/tools.html" aria-label="Tools"><!---->Tools<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">MicroCity <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/visualization.html" aria-label="Visualization of Results"><!---->Visualization of Results<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/network.html" aria-label="Operating Networks"><!---->Operating Networks<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/lp.html" aria-label="Model Solving"><!---->Model Solving<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active collapsible">MicroCityWeb <span class="down arrow"></span></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/web-ui.html" aria-label="User Interface Overview"><!---->User Interface Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/3d-scene.html" aria-label="3D Scene"><!---->3D Scene<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/3d-objects.html" aria-label="3D Objects"><!---->3D Objects<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/MicroCityNotes/en/notes/event-scheduling.html" aria-label="Discrete Event Simulation and Program Control"><!---->Discrete Event Simulation and Program Control<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/mip.html" aria-label="Mixed integer programming"><!---->Mixed integer programming<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/debug.html" aria-label="Debugging"><!---->Debugging<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">Concepts <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/warehouse-simulation.html" aria-label="Ideas for Warehouse Automation Simulation"><!---->Ideas for Warehouse Automation Simulation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/plots.html" aria-label="General Drawing Code"><!---->General Drawing Code<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/MicroCityNotes/en/notes/cy-simulation.html" aria-label="Port AGV Service Process 3D Simulation Approach"><!---->Port AGV Service Process 3D Simulation Approach<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="discrete-event-simulation-and-program-control" tabindex="-1"><a class="header-anchor" href="#discrete-event-simulation-and-program-control"><span>Discrete Event Simulation and Program Control</span></a></h1><p>This article mainly introduces how to implement discrete event simulation and program control in MicroCity Web.</p><h2 id="coroutine" tabindex="-1"><a class="header-anchor" href="#coroutine"><span>Coroutine</span></a></h2><p>MicroCity Web provides several coroutine-related functions, which facilitate the implementation of event scheduling. If you primarily use it for event scheduling and are not clear about the principles of event scheduling, you can read the <a href="./timelapse#Event-Scheduling">Time-lapse Event Scheduling</a> section to understand the relevant concepts.</p><h3 id="coroutine-queue" tabindex="-1"><a class="header-anchor" href="#coroutine-queue"><span>coroutine.queue</span></a></h3><p>Add a function or coroutine to the coroutine queue for waiting execution.</p><div class="language-lua" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line">coroutine<span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> f<span class="token operator">|</span>co <span class="token punctuation">[</span><span class="token punctuation">,</span> parameter list<span class="token punctuation">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>Parameters</p><table><thead><tr><th>Parameter</th><th>Meaning</th></tr></thead><tbody><tr><td><code>rt</code></td><td>The time relative to the current queue, which must be greater than or equal to 0. In other words, it is the time for executing the input function or coroutine after <code>rt</code>.</td></tr><tr><td><code>f/co</code></td><td>The function or coroutine. If it is a function, only the function name needs to be inputted.</td></tr></tbody></table><h3 id="coroutine-qtime" tabindex="-1"><a class="header-anchor" href="#coroutine-qtime"><span>coroutine.qtime</span></a></h3><p>Get the current queue time.</p><div class="language-lua" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token keyword">local</span> time <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">qtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h3 id="example" tabindex="-1"><a class="header-anchor" href="#example"><span>Example</span></a></h3><p>Two examples are provided here:</p><ol><li><a href="#Coroutines-Adding-Tasks">Coroutines Adding Tasks</a>: Using coroutines to add tasks and displaying the current queue time in the function.</li><li><a href="#Vehicle-Movement">Vehicle Movement</a>: Using coroutines to implement scene refreshing based on real-world time.</li></ol><h4 id="coroutines-adding-tasks" tabindex="-1"><a class="header-anchor" href="#coroutines-adding-tasks"><span>Coroutines Adding Tasks</span></a></h4><p>This example demonstrates how to use coroutines to add tasks and display the current queue time in the function.</p><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Current time: &quot;</span><span class="token punctuation">,</span> coroutine<span class="token punctuation">.</span><span class="token function">qtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">ShowShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Current time short: &quot;</span><span class="token punctuation">,</span> coroutine<span class="token punctuation">.</span><span class="token function">qtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line">coroutine<span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> Show<span class="token punctuation">)</span></span>
<span class="line">coroutine<span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> Show<span class="token punctuation">)</span></span>
<span class="line">coroutine<span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> ShowShort<span class="token punctuation">)</span></span>
<span class="line">coroutine<span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> Show<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Result:</span></span>
<span class="line"><span class="token comment">-- Current time: 5.0</span></span>
<span class="line"><span class="token comment">-- Current time: 10.0</span></span>
<span class="line"><span class="token comment">-- Current time short: 15.0</span></span>
<span class="line"><span class="token comment">-- Current time: 20.0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="vehicle-movement" tabindex="-1"><a class="header-anchor" href="#vehicle-movement"><span>Vehicle Movement</span></a></h4><p>This example demonstrates how to use coroutines to implement scene refreshing based on real-world time.</p><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line">scene<span class="token punctuation">.</span><span class="token function">setenv</span><span class="token punctuation">(</span><span class="token punctuation">{</span>grid <span class="token operator">=</span> <span class="token string">&#39;plane&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">-- Set the scene grid background</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Vehicle</span></span>
<span class="line"><span class="token keyword">local</span> car <span class="token operator">=</span> scene<span class="token punctuation">.</span><span class="token function">addobj</span><span class="token punctuation">(</span><span class="token string">&#39;/res/2axle.glb&#39;</span><span class="token punctuation">)</span></span>
<span class="line">car<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">-- Car speed</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Initial time</span></span>
<span class="line"><span class="token keyword">local</span> t <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">local</span> dt <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Refresh the time state t and dt (step according to CPU interval to synchronize with real time)</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">refreshtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    dt <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t</span>
<span class="line">    t <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Coroutine updating scene</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">not</span> scene<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span> <span class="token comment">-- Render the scene and check if the program is terminated</span></span>
<span class="line">    coroutine<span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span>dt<span class="token punctuation">,</span> update<span class="token punctuation">)</span> <span class="token comment">-- Add the next update based on CPU step time</span></span>
<span class="line">    <span class="token function">carmove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- Move the car</span></span>
<span class="line">    <span class="token function">refreshtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- Calculate the current dt</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Vehicle movement</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">carmove</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Car moves at &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">local</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token operator">=</span> car<span class="token punctuation">:</span><span class="token function">getpos</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    car<span class="token punctuation">:</span><span class="token function">setpos</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token operator">+</span> dt <span class="token operator">*</span> car<span class="token punctuation">.</span>speed<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Initial update (add the first update)</span></span>
<span class="line"><span class="token comment">-- Because subsequent updates are involved in the function, the updates will automatically loop</span></span>
<span class="line">coroutine<span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span>dt<span class="token punctuation">,</span> update<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://microcity.github.io/#s80gxo" target="_blank" rel="noopener noreferrer">Open in MicroCityWeb</a></p><h2 id="random-numbers" tabindex="-1"><a class="header-anchor" href="#random-numbers"><span>Random Numbers</span></a></h2><h3 id="introduction-to-the-principle-of-random-number-generation" tabindex="-1"><a class="header-anchor" href="#introduction-to-the-principle-of-random-number-generation"><span>Introduction to the Principle of Random Number Generation</span></a></h3><p>In a computer, the process of selecting random numbers is not truly random. In fact, everything we do in a computer is not truly random, and it can be proven that it is impossible to manufacture a computer that can truly generate random numbers. The random numbers we obtain are actually pseudo-random numbers.</p><p>So how are pseudo-random numbers generated? There is an algorithm that generates the next number in a sequence based on a given number. This algorithm is initialized with a seed, and then iterated to produce subsequent random number sequences. If the seed is the same, the generated random number sequences will also be the same.</p><p>Now, every time a different random sequence is needed, a seed is obtained by reading the computer&#39;s clock. The principle behind this is that since it is impossible to know the exact moment when a program is started, each program start can be considered as obtaining a random number to be used as a seed.</p><p>Therefore, it can be anticipated that the resulting random number sequence is unpredictable, because we do not know what the random number seed will be.</p><h3 id="creating-random-number-seeds" tabindex="-1"><a class="header-anchor" href="#creating-random-number-seeds"><span>Creating Random Number Seeds</span></a></h3><div class="language-lua" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token keyword">local</span> seed <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">randomseed</span><span class="token punctuation">(</span>x <span class="token punctuation">[</span><span class="token punctuation">,</span> dist<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>Parameters</p><table><thead><tr><th>Parameter</th><th>Meaning</th></tr></thead><tbody><tr><td><code>x</code></td><td>Random number seed, which will return different random numbers based on different input values. If different values are needed each time, the random number seed <code>x</code> can be set to the current time.</td></tr><tr><td><code>dist</code></td><td>Random number distribution (optional parameter). If not set, it defaults to a uniform distribution. If this parameter is set, <code>mu</code> and <code>sigma</code> can also be set as parameters for the corresponding distribution.</td></tr></tbody></table><p>The <code>dist</code> parameter can be set with three types of distribution:</p><ul><li><code>&#39;normal&#39;</code>: Normal distribution</li><li><code>&#39;exponential&#39;</code>: Exponential distribution</li><li><code>&#39;poisson&#39;</code>: Poisson distribution</li></ul><p>In addition, the parameters for these distributions can also be set, where the <code>mu</code> key represents the mean and the <code>sigma</code> key represents the variance.</p><h3 id="example-1" tabindex="-1"><a class="header-anchor" href="#example-1"><span>Example</span></a></h3><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token comment">-- Create a random number seed for Poisson distribution</span></span>
<span class="line"><span class="token keyword">local</span> seed <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">randomseed</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>distribution <span class="token operator">=</span> <span class="token string">&quot;poisson&quot;</span><span class="token punctuation">,</span> mu <span class="token operator">=</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">-- Poisson distribution with a mean of 3</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Output random number</span></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span>seed<span class="token punctuation">:</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="program-control" tabindex="-1"><a class="header-anchor" href="#program-control"><span>Program Control</span></a></h2><p>The program control mentioned in this article mainly refers to how to use the <a href="./web-ui#blue-command-area">buttons</a> in the user interface to control the program&#39;s operation, including pausing, resuming, stopping, etc.</p><div style="text-align:center;"><p><img src="/MicroCityNotes/assets/CommandBar--7npD8pQ.png" alt="Command Bar"> Command Bar</p></div><blockquote><p>It mainly refers to the first 3 buttons in the command bar.</p></blockquote><p>Program control in MicroCity Web mainly refers to the pause, resume, and stop of 3D interface rendering implemented through the <code>scene</code> object, with specific functions as follows:</p><div class="language-lua" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token keyword">local</span> state <span class="token operator">=</span> scene<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>Here, the return value of <code>scene.render()</code> is stored in the variable <code>state</code>, and the value of the <code>state</code> variable is either <code>true</code> or <code>false</code>, representing the program&#39;s running state as running or terminated (button 3 pressed in the command bar).</p><p>The pause of rendering of 3D objects is also achieved by calling <code>scene.render()</code>. If refreshing 3D objects is achieved by continuously calling the <code>scene.render()</code> function and the refresh interval is not controlled by <code>os.sleep()</code>, it is possible to pause the rendering at a certain state on the 3D interface. This is because if the movement speed of 3D objects is controlled by <code>os.sleep()</code>, clicking the pause button might happen during the <code>os.sleep()</code> process, causing the program to not respond immediately and thus making the pause button ineffective. Therefore, it is recommended to avoid using <code>os.sleep()</code> for controlling the motion speed of 3D objects, and instead control the advancement duration by adding other parameters to achieve the purpose of controlling the speed of 3D object movement.</p><blockquote><p>This post is translated using ChatGPT, please <a href="https://github.com/huuhghhgyg/MicroCityNotes/issues/new" target="_blank" rel="noopener noreferrer"><strong>feedback</strong></a> if any omissions.</p></blockquote></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: huuhghhgyg@outlook.com">huuhghhgyg</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/MicroCityNotes/en/notes/3d-objects.html" aria-label="3D Objects"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>3D Objects</span></div></a><a class="route-link auto-link next" href="/MicroCityNotes/en/notes/mip.html" aria-label="Mixed integer programming"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Mixed integer programming</span></div></a></nav><!--[--><!--[--><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><!--]--></main><!--]--></div><!--[--><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/MicroCityNotes/assets/app-DBXIMjCi.js" defer></script>
  </body>
</html>
